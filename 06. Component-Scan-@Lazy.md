# ğŸŒ± Component Scan

## **ğŸ“Œ 1. Äá»‹nh nghÄ©a**

- Cho phÃ©p Spring Boot tá»± Ä‘á»™ng tÃ¬m kiáº¿m vÃ  quáº£n lÃ½ cÃ¡c `Bean` trong á»©ng dá»¥ng cá»§a chÃºng ta.

- Máº·c Ä‘á»‹nh, Spring Boot sáº½ quÃ©t toÃ n bá»™ cÃ¡c package vÃ  cÃ¡c package con cá»§a package chá»©a hÃ m main.

- VÃ­ dá»¥:

  - Náº¿u **`@StoreApplication`** náº±m trong package `com.example.store`, thÃ¬ Spring sáº½ quÃ©t:
    - `com.example.store`
    - `com.example.store.model`
    - `com.example.store.service`
    - `com.example.store.config`

- Äiá»u gÃ¬ sáº½ xáº£y ra khi má»™t class náº±m ngoÃ i pháº¡m vi quÃ©t

  - NÃ³ sáº½ khÃ´ng Ä‘Æ°á»£c quÃ©t vÃ  Spring sáº½ khÃ´ng biáº¿t Ä‘áº¿n class Ä‘Ã³
  - VÃ­ dá»¥:

    ````java
    package com.springmall;

        @Component
        public class Car{
            // KhÃ´ng Ä‘Æ°á»£c Spring quáº£n lÃ½
        }
        ```

    â¡ï¸ Khi gá»i **`context.getBean(Car.class)`**, Spring sáº½ bÃ¡o lá»—i _`NoSuchBeanDefinitionException`_.
    ````

## **ğŸ”¹ 2. Thay Ä‘á»•i pháº¡m vi Component Scan**

- Trong trÆ°á»ng há»£p muá»‘n tÃ¹y chá»‰nh cáº¥u hÃ¬nh cho **`Component Scan`** Ä‘á»ƒ chá»‰ tÃ¬m kiá»ƒm cÃ¡c **`Bean`** trong má»™t package nháº¥t Ä‘á»‹nh, cÃ³ 3 cÃ¡ch:

  ### ğŸ³ 2.1. Sá»­ dá»¥ng **`@Component Scan`**

  - Náº¿u `Car` náº±m ngoÃ i package máº·c Ä‘á»‹nh, chÃºng ta cáº§n chá»‰ Ä‘á»‹nh Spring quÃ©t nÃ³ báº±ng **`@Component Scan`**

  ```java
  @SpringBootApplication
  @ComponentScan("com.springmall")

  public class StoreApplication{
      public static void main(String[] args){
          SpringApplication.run(StoreApplication.class, args);
      }
  }
  ```

  ### ğŸµ 2.2. Sá»­ dá»¥ng **`@Component Scan`** vá»›i `basePackages`

  ```java
  @Configuration
  @ComponentScan(basePackages = {"com.springmall.store", "com.springmall"})

  public class AppConfig{
  }
  ```

  ğŸ“Œ CÃ¡ch nÃ y há»¯u Ã­ch khi khÃ´ng muá»‘n sá»­a **`StoreApplication.java`**.

  ### ğŸ© 2.3. Sá»­ dá»¥ng `scanBasePackages` trong `@SpringBootApplication`

  ```java
  @SpringBootApplication(scanBasePackages = "com.springmall")

  public class StoreApplication{
      public static void main(String[] args){
          SpringApplication.run(StoreApplication.class, args);
      }
  }
  ```

  ### ğŸ 2.4. Äá»‹nh nghÄ©a **`@Bean`** trong **`AppConfig.java`**

  - Thá»±c hiá»‡n nhÆ° pháº§n **`Bean.md`**

  ### ğŸ¥¥ 2.5. Multiple package scan

  - CÃ³ thá»ƒ cáº¥u hÃ¬nh cho **Spring Boot** tÃ¬m kiáº¿m cÃ¡c `Bean` á»Ÿ nhiá»u package khÃ¡c nhau.

  ```java
  @ComponentScan({"com.springmall.store","com.springmall"})
  ```

  ```java
  @SpringBootApplication(scanBasePackages = {"com.springmall", "com.springmall.store"})
  ```

## **ğŸŒ¿ 3. Lazy-initialize Beans**

- Eager (hÃ¡o há»©c): `Bean` Ä‘Æ°á»£c táº¡o ngay khi cháº¡y chÆ°Æ¡ng trÃ¬nh - **`@Scope("singleton")`**

- Lazy (lÆ°á»i): `Bean` Ä‘Æ°á»£c táº¡o ra khi chÃºng ta gá»i Ä‘áº¿n nÃ³ - **`@Scope("prototype")`**

- CÃ¡ch dÃ¹ng **`@Lazy`** trÃªn má»™t **`@Bean`** trong **`AppConfig.java`**:

  ```java
  @Configuration
  public class AppConfig{

      @Bean
      @Lazy
      public Engine engine(){
          System.out.println("Engine Bean Ä‘Æ°á»£c táº¡o!");
          return new Engine("V8");
      }
  }
  ```

- Káº¿t quáº£:

  - Náº¿u khÃ´ng dÃ¹ng **`@Lazy`**, Engine sáº½ Ä‘Æ°á»£c táº¡o ngay khi á»©ng dá»¥ng cháº¡y.

  - Náº¿u dÃ¹ng **`@Lazy`**, Engine chá»‰ Ä‘Æ°á»£c khá»Ÿi táº¡o khi má»™t bean khÃ¡c cáº§n nÃ³.

- CÃ¡ch dÃ¹ng **`@Lazy`** trÃªn má»™t **`@Component`**:
  ```java
  @Component
  @Lazy
  public class Car{
      public Car(){
          System.out.println("Car Bean Ä‘Æ°á»£c táº¡o!");
      }
  }
  ```
- LÆ°u Ã½:
  - Khi láº¥y `Car` láº§n Ä‘áº§u báº±ng **`context.getBean(Car.class)`**, Spring má»›i táº¡o instance cá»§a nÃ³.

## **ğŸ˜Š 4. CÃ¡ch báº­t Lazy Initialization cho toÃ n bá»™ á»©ng dá»¥ng**

- DÃ¹ng **`@ComponentScan(lazyInit = true)`**
- VÃ­ dá»¥:

  ```java
  @SpringBootApplication
  @EnableAutoConfiguration
  @ComponentScan(lazyInit = true) // KÃ­ch hoáº¡t lazy init toÃ n cá»¥c

  public class StoreApplication{
      public static void main(String[] args){
          SpringApplication.run(StoreApplication.class, args);
      }
  }
  ```

- Káº¿t quáº£:
  - Má»i bean sáº½ chá»‰ Ä‘Æ°á»£c khá»Ÿi táº¡o khi cáº§n thiáº¿t, giÃºp giáº£m thá»i gian khá»Ÿi Ä‘á»™ng á»©ng dá»¥ng.
- Khi nÃ o nÃªn dÃ¹ng **`@Lazy`**:

  - Khi bean khÃ´ng cáº§n thiáº¿t ngay khi khá»Ÿi Ä‘á»™ng (vÃ­ dá»¥: má»™t bean chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng trong má»™t API nháº¥t Ä‘á»‹nh).

  - Khi á»©ng dá»¥ng cÃ³ nhiá»u bean nhÆ°ng chá»‰ má»™t sá»‘ Ã­t Ä‘Æ°á»£c sá»­ dá»¥ng thÆ°á»ng xuyÃªn (giáº£m tÃ i nguyÃªn sá»­ dá»¥ng ban Ä‘áº§u).

  - Khi muá»‘n tÄƒng tá»‘c khá»Ÿi Ä‘á»™ng á»©ng dá»¥ng, Ä‘áº·c biá»‡t vá»›i á»©ng dá»¥ng lá»›n hoáº·c microservices.

  - KhÃ´ng nÃªn dÃ¹ng @Lazy náº¿u bean thá»±c sá»± cáº§n thiáº¿t ngay tá»« Ä‘áº§u, vÃ¬ cÃ³ thá»ƒ gÃ¢y lá»—i náº¿u khÃ´ng Ä‘Æ°á»£c khá»Ÿi táº¡o ká»‹p.
