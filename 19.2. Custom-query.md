ğŸ¯ Tuyá»‡t vá»i! ÄÃ¢y lÃ  bÆ°á»›c **nÃ¢ng cao vÃ  cá»±c ká»³ quan trá»ng** khi lÃ m viá»‡c vá»›i Spring Data JPA:

> ğŸ“Œ **Custom Query báº±ng `@Query` annotation** â€” cho phÃ©p báº¡n **viáº¿t truy váº¥n SQL/JPQL tÃ¹y chá»‰nh**, khÃ´ng phá»¥ thuá»™c vÃ o cÃ¡ch Ä‘áº·t tÃªn hÃ m ná»¯a.

---

# ğŸ“˜ Giáº£i thÃ­ch chi tiáº¿t `@Query` trong Spring Data JPA

---

## âœ… 1. Má»¥c Ä‘Ã­ch cá»§a `@Query`

> DÃ¹ng khi báº¡n muá»‘n **viáº¿t cÃ¢u truy váº¥n tÃ¹y chá»‰nh** thay vÃ¬ Ä‘á»ƒ Spring tá»± suy luáº­n qua tÃªn hÃ m.

âœ” Há»¯u Ã­ch khi:

- Truy váº¥n phá»©c táº¡p (join, group by, limit)
- KhÃ´ng thá»ƒ diá»…n táº£ báº±ng tÃªn hÃ m
- Cáº§n dÃ¹ng `JOIN`, `SUBQUERY`, `ORDER`, v.v.

---

## ğŸ“„ VÃ­ dá»¥ báº¡n Ä‘Æ°a:

```java
@Query("SELECT p FROM Product p WHERE p.price > :min")
List<Product> findExpensive(@Param("min") double minPrice);
```

---

## ğŸ§  Giáº£i thÃ­ch tá»«ng pháº§n:

| ThÃ nh pháº§n                      | Ã nghÄ©a                                           |
| ------------------------------- | ------------------------------------------------- |
| `@Query(...)`                   | Viáº¿t truy váº¥n theo kiá»ƒu **JPQL**                  |
| `"SELECT p FROM Product p"`     | Chá»n táº¥t cáº£ tá»« **entity `Product`**, alias lÃ  `p` |
| `WHERE p.price > :min`          | Äiá»u kiá»‡n lá»c: `price` lá»›n hÆ¡n giÃ¡ trá»‹ `:min`     |
| `:min`                          | **Biáº¿n bind** (Ä‘Æ°á»£c gÃ¡n tá»« `@Param("min")`)       |
| `@Param("min") double minPrice` | Tham sá»‘ truyá»n vÃ o tá»« method                      |

---

### ğŸ” LÆ°u Ã½: ÄÃ¢y lÃ  **JPQL**, khÃ´ng pháº£i SQL â—

| JPQL (Java Persistence Query Language) | SQL truyá»n thá»‘ng           |
| -------------------------------------- | -------------------------- |
| DÃ¹ng tÃªn **entity** vÃ  **field**       | DÃ¹ng tÃªn báº£ng vÃ  cá»™t       |
| `Product`, `price`                     | `product`, `product_price` |
| `SELECT p FROM Product p`              | `SELECT * FROM product`    |

---

## âœ… Káº¿t quáº£:

ğŸ‘‰ Khi báº¡n gá»i:

```java
findExpensive(100.0);
```

â¡ï¸ Hibernate sáº½ sinh ra truy váº¥n:

```sql
SELECT * FROM product WHERE price > 100.0;
```

âœ… Káº¿t quáº£ lÃ  danh sÃ¡ch `Product` cÃ³ `price > 100.0`

---

## âœ… 2. CÃ¡ch truyá»n biáº¿n trong `@Query`

| CÃ¡ch                     | CÃº phÃ¡p                 | Ghi chÃº           |
| ------------------------ | ----------------------- | ----------------- |
| **Named parameter**      | `:min`, `@Param("min")` | âœ… KhuyÃªn dÃ¹ng    |
| **Positional parameter** | `?1`, `?2`              | KhÃ´ng cáº§n Ä‘áº·t tÃªn |

---

## âœ… 3. CÃ³ thá»ƒ dÃ¹ng vá»›i nhiá»u Ä‘iá»u kiá»‡n

```java
@Query("SELECT p FROM Product p WHERE p.name LIKE %:keyword% AND p.price BETWEEN :min AND :max")
List<Product> search(@Param("keyword") String keyword,
                     @Param("min") Double min,
                     @Param("max") Double max);
```

---

## âœ… 4. Native SQL query

> Khi cáº§n truy váº¥n **SQL chuáº©n** (khÃ´ng qua entity), báº¡n dÃ¹ng:

```java
@Query(value = "SELECT * FROM product WHERE price > :min", nativeQuery = true)
List<Product> rawQuery(@Param("min") double min);
```

---

## âœ… 5. TÃ³m táº¯t

| Æ¯u Ä‘iá»ƒm `@Query`                          | âœ…  |
| ----------------------------------------- | --- |
| Viáº¿t truy váº¥n tÃ¹y chá»‰nh                   | âœ”ï¸  |
| Truy váº¥n phá»©c táº¡p (join, sort, limit,...) | âœ”ï¸  |
| CÃ³ thá»ƒ dÃ¹ng SQL tháº­t (native)             | âœ”ï¸  |
| Káº¿t há»£p dá»… vá»›i `@Param`                   | âœ”ï¸  |

---

## âš ï¸ LÆ°u Ã½

| Cáº©n tháº­n                                      | VÃ¬ sao                               |
| --------------------------------------------- | ------------------------------------ |
| Sai tÃªn entity hoáº·c field â†’ lá»—i runtime       | JPQL dÃ¹ng class, khÃ´ng dÃ¹ng tÃªn báº£ng |
| KhÃ´ng truyá»n Ä‘Ãºng tÃªn `@Param(...)`           | GÃ¢y lá»—i query khÃ´ng bind biáº¿n        |
| NÃªn test truy váº¥n ká»¹ trÆ°á»›c khi Ä‘Æ°a production | âœ”ï¸                                   |

---

ğŸ“Œ Báº¡n muá»‘n mÃ¬nh viáº¿t:

- Má»™t `@Query` dÃ¹ng `JOIN`
- Má»™t custom query lá»c sáº£n pháº©m theo nhiá»u tiÃªu chÃ­ (keyword + price + category)?

ğŸ‘‰ Chá»‰ cáº§n nÃ³i **â€œLÃ m query nÃ¢ng cao vá»›i joinâ€**, mÃ¬nh build cho báº¡n luÃ´n nhÃ© ğŸ”§ğŸ¤–
