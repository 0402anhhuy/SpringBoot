# 🌱 Derived Query Method

## 🥠 Khái niệm

- Là phương thức **tự động tạo truy vấn SQL chỉ bằng tên hàm** trong `Repository`

- Spring sẽ **phân tích tên hàm → sinh ra SQL tương ứng** (Không cần viết SQL hoặc JPQL thủ công)

- Viết tên hàm đúng cú pháp → sử dụng được luôn

## 🍠 Cách hoạt động

### 🔎 Ví dụ

- Tạo **Entity** `Product` với các trường `id`, `name`, `price`

**`Product.java`**

```java
@Entity
public class Product {
    @Id
    private Long id;

    private String name;
    private Double price;
}
```

- Tạo **Repository** `ProductRepository` kế thừa `JpaRepository`

**`ProductRepository.java`**

```java
public interface ProductRepository extends JpaRepository<Product, Long> {
    List<Product> findByNameContaining(String keyword);
    Product findByIdAndName(Long id, String name);
}
```

## ✨ Giải thích

### 🧧 `List<Product> findByNameContaining(String keyword)`

| Thành phần       | Ý nghĩa                    |
| ---------------- | -------------------------- |
| `findBy`         | Đây là 1 truy vấn          |
| `Name`           | Tên của field trong entity |
| `Containing`     | Tìm theo LIKE `%keyword%`  |
| `String keyword` | Tham số truyền vào         |

🥎 Spring Boot tạo câu truy vấn SQL

```sql
SELECT * FROM product WHERE name LIKE '%keyword%'
```

### 🎨 `Product findByIdAndName(Long id, String name)`

| Thành phần  | Ý nghĩa                   |
| ----------- | ------------------------- |
| `findBy`    | Truy vấn                  |
| `IdAndName` | WHERE id = ? AND name = ? |

🏈 SQL tương ứng:

```sql
SELECT * FROM product WHERE id = ? AND name = ?
```

## 🧠 4. Các keyword thường dùng

| Tên method | Ý nghĩa  |
| ---------- | -------- |
| `findBy`   | Tìm      |
| `readBy`   | Tương tự |
| `getBy`    | Tương tự |

| Từ khóa                      | SQL                      |
| ---------------------------- | ------------------------ |
| `And`, `Or`                  | `AND`, `OR`              |
| `Is`, `Equals`               | `=`                      |
| `Between`                    | BETWEEN                  |
| `LessThan`, `GreaterThan`    | `<`, `>`                 |
| `Like`, `Containing`         | `LIKE`, `%...%`          |
| `StartingWith`, `EndingWith` | `LIKE 'xxx%'`, `'xxx'`   |
| `In`, `NotIn`                | `IN (...)`               |
| `IsNull`, `IsNotNull`        | `IS NULL`, `IS NOT NULL` |

---

## ✅ 5. Ví dụ thực tế

```java
// Lấy tất cả product có giá nhỏ hơn 500
List<Product> findByPriceLessThan(Double price);

// Tìm theo tên và giá
Product findByNameAndPrice(String name, Double price);

// Lấy sản phẩm có tên bắt đầu bằng “iPhone”
List<Product> findByNameStartingWith(String prefix);

// Tìm theo danh sách ID
List<Product> findByIdIn(List<Long> ids);
```

---

## ⚠️ 6. Quy tắc đặt tên

| Quy tắc                         | Ví dụ                                                                                 |
| ------------------------------- | ------------------------------------------------------------------------------------- |
| Tên phải **đúng với tên field** | Nếu entity là `Product` có `name`, `price`, thì `findByPrice`, `findByName` là hợp lệ |
| Phân biệt **camelCase**         | `findByProductName` ≠ `findByproductname`                                             |
| Sai tên field = ❌ lỗi runtime  | Vì JPA không tìm thấy column tương ứng                                                |

---

## ✅ 7. Tóm lại

| Ưu điểm                            | ✅ Có |
| ---------------------------------- | ----- |
| Không cần viết SQL                 | ✔️    |
| Tự động sinh truy vấn              | ✔️    |
| Gọn, dễ dùng với project nhỏ & vừa | ✔️    |
| Dễ đọc, dễ hiểu                    | ✔️    |

| Hạn chế               | ❌                          |
| --------------------- | --------------------------- |
| Truy vấn quá phức tạp | Nên dùng `@Query`           |
| Tên hàm dài, rối      | Nên tách nhỏ / custom query |

---

📌 Bạn muốn mình tạo 1 file `ProductRepository` với 10 method thực chiến?
Hay build demo “Tìm kiếm sản phẩm theo tên và khoảng giá”?

👉 Chỉ cần nói “Demo tìm kiếm nâng cao JPA”, mình code liền 🔧🤖
