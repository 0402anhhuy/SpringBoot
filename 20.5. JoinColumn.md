🔥 Tuyệt vời! Đây là một annotation **rất quan trọng khi làm việc với quan hệ giữa các bảng** trong JPA/Hibernate:

> 📘 **`@JoinColumn`** – dùng để chỉ định **khóa ngoại (foreign key)** trong quan hệ giữa các entity

---

# ✅ Lý thuyết đầy đủ về `@JoinColumn` trong JPA/Hibernate

---

## ✅ 1. `@JoinColumn` là gì?

> `@JoinColumn` được dùng để **chỉ rõ thông tin của cột khóa ngoại (FK)** khi bạn thiết lập các mối quan hệ `@ManyToOne`, `@OneToOne`, `@ManyToMany` (bên chủ động).

```java
@ManyToOne
@JoinColumn(name = "category_id") // Chỉ định tên cột FK
private Category category;
```

📌 Tức là trong bảng `product`, Hibernate sẽ tạo ra một **cột `category_id`**, dùng để ánh xạ tới bảng `category`.

---

## ✅ 2. Vị trí dùng `@JoinColumn`

| Annotation quan hệ | Có dùng `@JoinColumn`?                          | Ghi chú               |
| ------------------ | ----------------------------------------------- | --------------------- |
| `@ManyToOne`       | ✅ Có                                           | Quan hệ phổ biến nhất |
| `@OneToOne`        | ✅ Có                                           | Cả 2 chiều            |
| `@OneToMany`       | ❌ Không dùng ở chiều bị động (dùng `mappedBy`) |                       |
| `@ManyToMany`      | ✅ Dùng trong `@JoinTable`                      |                       |

---

## ✅ 3. Các thuộc tính của `@JoinColumn`

| Thuộc tính             | Ý nghĩa                                               |
| ---------------------- | ----------------------------------------------------- |
| `name`                 | Tên cột FK trong bảng hiện tại                        |
| `referencedColumnName` | Tên cột bên bảng gốc được tham chiếu (mặc định là PK) |
| `nullable`             | Có cho phép null không                                |
| `unique`               | Cột FK có phải duy nhất không                         |
| `insertable`           | Có cho phép insert không                              |
| `updatable`            | Có cho phép update không                              |

---

## ✅ 4. Ví dụ đầy đủ

### 💡 Quan hệ `Product` – `Category` (N:1)

```java
@Entity
public class Product {

    @Id
    private Long id;

    @ManyToOne
    @JoinColumn(
        name = "category_id",                // FK trong bảng product
        referencedColumnName = "id",         // PK bảng category
        nullable = false                     // Không được để null
    )
    private Category category;
}
```

📌 Hibernate sẽ sinh SQL:

```sql
ALTER TABLE product ADD COLUMN category_id BIGINT NOT NULL;
ALTER TABLE product ADD CONSTRAINT FK_category FOREIGN KEY (category_id) REFERENCES category(id);
```

---

## ✅ 5. `@JoinColumn` trong `@OneToOne`

```java
@OneToOne
@JoinColumn(name = "user_profile_id")
private UserProfile profile;
```

➡ Khi quan hệ 1-1: cột FK `user_profile_id` sẽ **vừa là FK vừa là unique key**.

---

## ✅ 6. Không dùng `@JoinColumn` → Hibernate sẽ đặt tên mặc định

Nếu bạn **bỏ qua `@JoinColumn`**, Hibernate sẽ:

- Tự đặt tên theo format: `{tên_field}_{tên_PK_bên kia}`
- Ví dụ: `category_id`

📌 Nhưng tốt nhất **nên chỉ định rõ ràng bằng `@JoinColumn`** để tránh lỗi khó debug, đặc biệt khi bạn đổi tên field.

---

## ✅ 7. So sánh chiều chủ động & bị động

| Entity A   | Quan hệ                                                        | Entity B   |
| ---------- | -------------------------------------------------------------- | ---------- |
| `Product`  | ➡ `@ManyToOne` → có `@JoinColumn`                              | `Category` |
| `Category` | ⬅ `@OneToMany(mappedBy = "category")` → KHÔNG có `@JoinColumn` |            |

---

## ✅ 8. Lưu ý quan trọng

| Cẩn thận                               | Giải thích                             |
| -------------------------------------- | -------------------------------------- |
| Tên cột FK trùng với tên thật trong DB | Phải match với DDL                     |
| `nullable = false`                     | Có thể gây lỗi insert nếu không set FK |
| `referencedColumnName` thường là `id`  | Chỉ dùng nếu FK không trỏ tới PK       |

---

## ✅ Tóm tắt

| Bạn muốn...                  | Bạn dùng                                               |
| ---------------------------- | ------------------------------------------------------ |
| Chỉ định tên cột FK          | `@JoinColumn(name = "...")`                            |
| FK không được null           | `nullable = false`                                     |
| FK trỏ đến cột không phải ID | `referencedColumnName = "..."`                         |
| Đảm bảo rõ ràng quan hệ      | ✅ **Luôn dùng `@JoinColumn` nếu bạn là bên chủ động** |

---

📌 Muốn mình tạo **quan hệ đầy đủ Product – Category với `@JoinColumn`** và sinh SQL tương ứng?

Chỉ cần nói:

> **“Tạo demo Product – Category có JoinColumn”**
> Mình code từ entity, repo đến DB log cho bạn luôn nhé 💪🔧🤖
