ğŸ”¥ Tuyá»‡t vá»i! ÄÃ¢y lÃ  má»™t annotation **ráº¥t quan trá»ng khi lÃ m viá»‡c vá»›i quan há»‡ giá»¯a cÃ¡c báº£ng** trong JPA/Hibernate:

> ğŸ“˜ **`@JoinColumn`** â€“ dÃ¹ng Ä‘á»ƒ chá»‰ Ä‘á»‹nh **khÃ³a ngoáº¡i (foreign key)** trong quan há»‡ giá»¯a cÃ¡c entity

---

# âœ… LÃ½ thuyáº¿t Ä‘áº§y Ä‘á»§ vá» `@JoinColumn` trong JPA/Hibernate

---

## âœ… 1. `@JoinColumn` lÃ  gÃ¬?

> `@JoinColumn` Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ **chá»‰ rÃµ thÃ´ng tin cá»§a cá»™t khÃ³a ngoáº¡i (FK)** khi báº¡n thiáº¿t láº­p cÃ¡c má»‘i quan há»‡ `@ManyToOne`, `@OneToOne`, `@ManyToMany` (bÃªn chá»§ Ä‘á»™ng).

```java
@ManyToOne
@JoinColumn(name = "category_id") // Chá»‰ Ä‘á»‹nh tÃªn cá»™t FK
private Category category;
```

ğŸ“Œ Tá»©c lÃ  trong báº£ng `product`, Hibernate sáº½ táº¡o ra má»™t **cá»™t `category_id`**, dÃ¹ng Ä‘á»ƒ Ã¡nh xáº¡ tá»›i báº£ng `category`.

---

## âœ… 2. Vá»‹ trÃ­ dÃ¹ng `@JoinColumn`

| Annotation quan há»‡ | CÃ³ dÃ¹ng `@JoinColumn`?                          | Ghi chÃº               |
| ------------------ | ----------------------------------------------- | --------------------- |
| `@ManyToOne`       | âœ… CÃ³                                           | Quan há»‡ phá»• biáº¿n nháº¥t |
| `@OneToOne`        | âœ… CÃ³                                           | Cáº£ 2 chiá»u            |
| `@OneToMany`       | âŒ KhÃ´ng dÃ¹ng á»Ÿ chiá»u bá»‹ Ä‘á»™ng (dÃ¹ng `mappedBy`) |                       |
| `@ManyToMany`      | âœ… DÃ¹ng trong `@JoinTable`                      |                       |

---

## âœ… 3. CÃ¡c thuá»™c tÃ­nh cá»§a `@JoinColumn`

| Thuá»™c tÃ­nh             | Ã nghÄ©a                                               |
| ---------------------- | ----------------------------------------------------- |
| `name`                 | TÃªn cá»™t FK trong báº£ng hiá»‡n táº¡i                        |
| `referencedColumnName` | TÃªn cá»™t bÃªn báº£ng gá»‘c Ä‘Æ°á»£c tham chiáº¿u (máº·c Ä‘á»‹nh lÃ  PK) |
| `nullable`             | CÃ³ cho phÃ©p null khÃ´ng                                |
| `unique`               | Cá»™t FK cÃ³ pháº£i duy nháº¥t khÃ´ng                         |
| `insertable`           | CÃ³ cho phÃ©p insert khÃ´ng                              |
| `updatable`            | CÃ³ cho phÃ©p update khÃ´ng                              |

---

## âœ… 4. VÃ­ dá»¥ Ä‘áº§y Ä‘á»§

### ğŸ’¡ Quan há»‡ `Product` â€“ `Category` (N:1)

```java
@Entity
public class Product {

    @Id
    private Long id;

    @ManyToOne
    @JoinColumn(
        name = "category_id",                // FK trong báº£ng product
        referencedColumnName = "id",         // PK báº£ng category
        nullable = false                     // KhÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ null
    )
    private Category category;
}
```

ğŸ“Œ Hibernate sáº½ sinh SQL:

```sql
ALTER TABLE product ADD COLUMN category_id BIGINT NOT NULL;
ALTER TABLE product ADD CONSTRAINT FK_category FOREIGN KEY (category_id) REFERENCES category(id);
```

---

## âœ… 5. `@JoinColumn` trong `@OneToOne`

```java
@OneToOne
@JoinColumn(name = "user_profile_id")
private UserProfile profile;
```

â¡ Khi quan há»‡ 1-1: cá»™t FK `user_profile_id` sáº½ **vá»«a lÃ  FK vá»«a lÃ  unique key**.

---

## âœ… 6. KhÃ´ng dÃ¹ng `@JoinColumn` â†’ Hibernate sáº½ Ä‘áº·t tÃªn máº·c Ä‘á»‹nh

Náº¿u báº¡n **bá» qua `@JoinColumn`**, Hibernate sáº½:

- Tá»± Ä‘áº·t tÃªn theo format: `{tÃªn_field}_{tÃªn_PK_bÃªn kia}`
- VÃ­ dá»¥: `category_id`

ğŸ“Œ NhÆ°ng tá»‘t nháº¥t **nÃªn chá»‰ Ä‘á»‹nh rÃµ rÃ ng báº±ng `@JoinColumn`** Ä‘á»ƒ trÃ¡nh lá»—i khÃ³ debug, Ä‘áº·c biá»‡t khi báº¡n Ä‘á»•i tÃªn field.

---

## âœ… 7. So sÃ¡nh chiá»u chá»§ Ä‘á»™ng & bá»‹ Ä‘á»™ng

| Entity A   | Quan há»‡                                                        | Entity B   |
| ---------- | -------------------------------------------------------------- | ---------- |
| `Product`  | â¡ `@ManyToOne` â†’ cÃ³ `@JoinColumn`                              | `Category` |
| `Category` | â¬… `@OneToMany(mappedBy = "category")` â†’ KHÃ”NG cÃ³ `@JoinColumn` |            |

---

## âœ… 8. LÆ°u Ã½ quan trá»ng

| Cáº©n tháº­n                               | Giáº£i thÃ­ch                             |
| -------------------------------------- | -------------------------------------- |
| TÃªn cá»™t FK trÃ¹ng vá»›i tÃªn tháº­t trong DB | Pháº£i match vá»›i DDL                     |
| `nullable = false`                     | CÃ³ thá»ƒ gÃ¢y lá»—i insert náº¿u khÃ´ng set FK |
| `referencedColumnName` thÆ°á»ng lÃ  `id`  | Chá»‰ dÃ¹ng náº¿u FK khÃ´ng trá» tá»›i PK       |

---

## âœ… TÃ³m táº¯t

| Báº¡n muá»‘n...                  | Báº¡n dÃ¹ng                                               |
| ---------------------------- | ------------------------------------------------------ |
| Chá»‰ Ä‘á»‹nh tÃªn cá»™t FK          | `@JoinColumn(name = "...")`                            |
| FK khÃ´ng Ä‘Æ°á»£c null           | `nullable = false`                                     |
| FK trá» Ä‘áº¿n cá»™t khÃ´ng pháº£i ID | `referencedColumnName = "..."`                         |
| Äáº£m báº£o rÃµ rÃ ng quan há»‡      | âœ… **LuÃ´n dÃ¹ng `@JoinColumn` náº¿u báº¡n lÃ  bÃªn chá»§ Ä‘á»™ng** |

---

ğŸ“Œ Muá»‘n mÃ¬nh táº¡o **quan há»‡ Ä‘áº§y Ä‘á»§ Product â€“ Category vá»›i `@JoinColumn`** vÃ  sinh SQL tÆ°Æ¡ng á»©ng?

Chá»‰ cáº§n nÃ³i:

> **â€œTáº¡o demo Product â€“ Category cÃ³ JoinColumnâ€**
> MÃ¬nh code tá»« entity, repo Ä‘áº¿n DB log cho báº¡n luÃ´n nhÃ© ğŸ’ªğŸ”§ğŸ¤–
