# üå± Annotation **`@Transactional`**

## üîç `@Transactional`

- **Qu·∫£n l√Ω giao d·ªãch (transaction) m·ªôt c√°ch t·ª± ƒë·ªông cho c√°c thao t√°c ƒë·ªçc/ghi d·ªØ li·ªáu v·ªõi database**

- M·ªôt method c√≥ `@Transactional` nghƒ©a l√† **m·ªçi thao t√°c v·ªõi database b√™n trong method n√†y ƒë∆∞·ª£c g√≥i g·ªçn trong 1 transaction (giao d·ªãch)**

- N·∫øu c√≥ l·ªói x·∫£y ra ‚Äì t·∫•t c·∫£ s·∫Ω **rollback** (quay lui), n·∫øu th√†nh c√¥ng th√¨ **commit**

## ü•≠ V√≠ d·ª•

```java
@Transactional
public void createOrder() {
    userRepository.save(user);
    orderRepository.save(order);
    paymentService.charge(order); // N·∫øu d√≤ng n√†y l·ªói, 2 thao t√°c tr√™n c≈©ng b·ªã rollback
}
```

> N·∫øu c√≥ l·ªói ·ªü `paymentService.charge()`, th√¨ `userRepository.save()` v√† `orderRepository.save()` c≈©ng **kh√¥ng ƒë∆∞·ª£c l∆∞u v√†o database**!

## üéØ T·∫°i sao c·∫ßn d√πng?

| Tr∆∞·ªùng h·ª£p        | L·ª£i √≠ch c·ªßa `@Transactional`                           |
| ----------------- | ------------------------------------------------------ |
| Ghi nhi·ªÅu b·∫£ng    | ƒê·∫£m b·∫£o t·∫•t c·∫£ ho·∫∑c kh√¥ng c√≥ g√¨ ƒë∆∞·ª£c l∆∞u               |
| ƒê·ªçc k·∫øt h·ª£p ghi   | Tr√°nh l·ªói d·ªØ li·ªáu t·∫°m th·ªùi ho·∫∑c b·ªã c·∫≠p nh·∫≠t gi·ªØa ch·ª´ng |
| G·ªçi nhi·ªÅu service | Qu·∫£n l√Ω xuy√™n su·ªët giao d·ªãch qua nhi·ªÅu l·ªõp             |
| X·ª≠ l√Ω ngo·∫°i l·ªá    | D·ªÖ d√†ng rollback khi g·∫∑p l·ªói ho·∫∑c exception            |

## ‚öôÔ∏è C√°ch d√πng ph·ªï bi·∫øn

```java
@Transactional
public void yourMethod() {
    // logic
}
```

### T√πy ch·ªânh:

```java
@Transactional(
  propagation = Propagation.REQUIRED,
  rollbackFor = Exception.class,
  readOnly = false
)
```

## üîÑ C√°c ch·∫ø ƒë·ªô Propagation

| M·ª©c Propagation      | √ù nghƒ©a                                             |
| -------------------- | --------------------------------------------------- |
| `REQUIRED` (default) | D√πng transaction ƒëang c√≥, n·∫øu kh√¥ng c√≥ th√¨ t·∫°o m·ªõi  |
| `REQUIRES_NEW`       | Lu√¥n t·∫°o transaction m·ªõi (ng·∫Øt c√°i c≈©)              |
| `NESTED`             | T·∫°o giao d·ªãch l·ªìng nhau (nested)                    |
| `SUPPORTS`           | D√πng n·∫øu c√≥, kh√¥ng th√¨ th√¥i                         |
| `NOT_SUPPORTED`      | T·∫°m ng·∫Øt transaction, ch·∫°y non-transaction          |
| `NEVER`              | Kh√¥ng ƒë∆∞·ª£c ph√©p ch·∫°y trong transaction              |
| `MANDATORY`          | B·∫Øt bu·ªôc ph·∫£i ƒëang trong transaction, kh√¥ng th√¨ l·ªói |

## üîÅ Rollback m·∫∑c ƒë·ªãnh v√† x·ª≠ l√Ω Exception

- **Ch·ªâ rollback khi c√≥ `RuntimeException` ho·∫∑c `Error`.**
- N·∫øu b·∫°n mu·ªën rollback cho `Exception` (checked), ph·∫£i khai b√°o:

```java
@Transactional(rollbackFor = Exception.class)
```
