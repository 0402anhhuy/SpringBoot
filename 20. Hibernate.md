# üå± Hibernate

## ü•¶ Kh√°i ni·ªám Hibernate

> **Hibernate** l√† m·ªôt **ORM (Object Relational Mapping) framework** trong Java, gi√∫p b·∫°n:

- D√πng **object Java (class)** thay v√¨ ph·∫£i vi·∫øt tay SQL
- T·ª± ƒë·ªông √°nh x·∫° (`@Entity`, `@Column`, ...) gi·ªØa **Java Object ‚Üî Table trong DB**
- Qu·∫£n l√Ω session, transaction, cache, lazy loading, v.v.

## ‚úÖ 2. Hibernate ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?

1. B·∫°n ƒë·ªãnh nghƒ©a **class Java (entity)** v·ªõi annotation nh∆∞ `@Entity`, `@Id`
2. Hibernate **t·ª± sinh c√¢u SQL** t∆∞∆°ng ·ª©ng ƒë·ªÉ insert/update/select d·ªØ li·ªáu
3. N√≥ d√πng c·∫•u tr√∫c **Session**, **EntityManager**, **Transaction** ƒë·ªÉ giao ti·∫øp DB

---

## ‚úÖ 3. C√°c annotation quan tr·ªçng trong Hibernate (JPA d√πng l·∫°i)

| Annotation                     | √ù nghƒ©a                           |
| ------------------------------ | --------------------------------- |
| `@Entity`                      | ƒê√°nh d·∫•u class l√† 1 b·∫£ng trong DB |
| `@Id`                          | ƒê·ªãnh nghƒ©a kh√≥a ch√≠nh             |
| `@GeneratedValue`              | T·ª± ƒë·ªông tƒÉng gi√° tr·ªã ID           |
| `@Column`                      | C·∫•u h√¨nh chi ti·∫øt cho 1 c·ªôt       |
| `@Table(name = "custom_name")` | ƒê·ªïi t√™n b·∫£ng                      |
| `@OneToMany`, `@ManyToOne`     | Quan h·ªá gi·ªØa c√°c b·∫£ng             |
| `@JoinColumn`, `@MappedBy`     | Ch·ªâ ƒë·ªãnh kh√≥a ngo·∫°i               |

---

## ‚úÖ 4. Lifecycle c·ªßa Hibernate (V√≤ng ƒë·ªùi entity)

| Tr·∫°ng th√°i     | √ù nghƒ©a                                    |
| -------------- | ------------------------------------------ |
| **Transient**  | M·ªõi kh·ªüi t·∫°o b·∫±ng `new`, ch∆∞a li√™n quan DB |
| **Persistent** | Hibernate ƒëang qu·∫£n l√Ω (ƒë√£ save)           |
| **Detached**   | ƒê√£ t·ª´ng ƒë∆∞·ª£c qu·∫£n l√Ω nh∆∞ng session b·ªã ƒë√≥ng |
| **Removed**    | ƒê√°nh d·∫•u x√≥a (s·∫Ω delete sau khi commit)    |

---

## ‚úÖ 5. Session & EntityManager

Hibernate d√πng `Session` ƒë·ªÉ giao ti·∫øp v·ªõi DB
‚Üí Spring Boot d√πng `EntityManager` (wrapper c·ªßa `Session`)

```java
entityManager.persist(entity); // insert
entityManager.find(Entity.class, id); // select
entityManager.remove(entity); // delete
```

‚û°Ô∏è Khi b·∫°n d√πng `JpaRepository.save(...)` th√¨ b√™n trong ch√≠nh l√† `EntityManager`!

---

## ‚úÖ 6. HQL (Hibernate Query Language)

> Hibernate c√≥ ng√¥n ng·ªØ ri√™ng g·ªçi l√† **HQL** ‚Äì gi·ªëng SQL nh∆∞ng d√πng t√™n class/property thay v√¨ table/column

```java
@Query("SELECT p FROM Product p WHERE p.name LIKE %:name%")
List<Product> searchByName(@Param("name") String name);
```

---

## ‚úÖ 7. Hibernate v√† Spring Boot

> Khi b·∫°n th√™m dependency:

```xml
<artifactId>spring-boot-starter-data-jpa</artifactId>
```

‚û°Ô∏è Spring Boot **auto c·∫•u h√¨nh Hibernate** lu√¥n:

- Qu·∫£n l√Ω `EntityManager`
- C·∫•u h√¨nh datasource, DDL
- Load entity t·ª´ package

---

## ‚úÖ 8. Hibernate t·ª± ƒë·ªông t·∫°o b·∫£ng ‚Äì `spring.jpa.hibernate.ddl-auto`

| Gi√° tr·ªã       | T√°c d·ª•ng                                       |
| ------------- | ---------------------------------------------- |
| `none`        | Kh√¥ng l√†m g√¨ c·∫£                                |
| `create`      | T·∫°o b·∫£ng m·ªõi m·ªói l·∫ßn (x√≥a to√†n b·ªô d·ªØ li·ªáu c≈©!) |
| `create-drop` | T·∫°o khi ch·∫°y app, x√≥a khi app t·∫Øt              |
| `update`      | ‚úÖ T·ª± t·∫°o b·∫£ng n·∫øu ch∆∞a c√≥, c·∫≠p nh·∫≠t n·∫øu thi·∫øu |
| `validate`    | So s√°nh schema, n·∫øu l·ªách s·∫Ω l·ªói                |

üëâ B·∫°n n√™n d√πng `update` trong dev, `validate` ho·∫∑c migration tool trong production

---

## ‚úÖ 9. Caching

Hibernate h·ªó tr·ª£:

- **First-level cache** (m·∫∑c ƒë·ªãnh trong session)
- **Second-level cache** (n√¢ng cao, t√≠ch h·ª£p EHCache, Redis,...)

---

## ‚úÖ 10. ∆Øu ƒëi·ªÉm c·ªßa Hibernate

| ∆Øu ƒëi·ªÉm                         | Gi·∫£i th√≠ch                    |
| ------------------------------- | ----------------------------- |
| Code Java s·∫°ch, √≠t SQL          | T·∫≠p trung vi·∫øt business logic |
| T·ª± ƒë·ªông √°nh x·∫° DB               | ƒê·ª° vi·∫øt `ResultSet` th·ªß c√¥ng  |
| D·ªÖ m·ªü r·ªông v·ªõi JPA, Spring Boot | ‚úîÔ∏è                            |
| Qu·∫£n l√Ω transaction t·ªët         | ‚úîÔ∏è                            |
| C√≥ lazy-loading, cascade        | Qu·∫£n l√Ω quan h·ªá hi·ªáu qu·∫£      |

---

## ‚úÖ L∆∞u √Ω khi d√πng Hibernate

| T√¨nh hu·ªëng                                         | C·∫£nh b√°o                      |
| -------------------------------------------------- | ----------------------------- |
| L·∫•y d·ªØ li·ªáu quan h·ªá qu√° nhi·ªÅu                      | ‚ö†Ô∏è D·ªÖ g√¢y `N+1 Query Problem` |
| Kh√¥ng d√πng `@Transactional`                        | ‚ö†Ô∏è G√¢y l·ªói lazy loading       |
| Kh√¥ng override `equals()` & `hashCode()` ƒë√∫ng c√°ch | ‚ö†Ô∏è L·ªói khi d√πng Set/List      |

---

## ‚úÖ K·∫øt lu·∫≠n

| T√≥m g·ªçn                                        | Gi√° tr·ªã |
| ---------------------------------------------- | ------- |
| Hibernate l√† **ORM engine ph·ªï bi·∫øn nh·∫•t Java** | ‚úîÔ∏è      |
| Spring Boot d√πng Hibernate ƒë·ªÉ x·ª≠ l√Ω JPA        | ‚úîÔ∏è      |
| Hi·ªÉu Hibernate = hi·ªÉu r√µ backend v·ªõi DB        | ‚úîÔ∏è      |
| B·∫°n kh√¥ng c·∫ßn vi·∫øt SQL tay qu√° nhi·ªÅu           | ‚úîÔ∏è      |

---

üëâ B·∫°n mu·ªën h·ªçc ti·∫øp ph·∫ßn n√†o sau Hibernate?

- Mapping quan h·ªá (`@OneToMany`, `@ManyToOne`)
- Transaction v√† rollback
- Custom query v·ªõi `@Query` ho·∫∑c Native SQL
- D√πng EntityManager th·ªß c√¥ng

C·ª© n√≥i **"B·∫Øt ƒë·∫ßu h·ªçc mapping quan h·ªá"** hay "custom query", m√¨nh d·∫°y ti·∫øp üí™üîßü§ñ
