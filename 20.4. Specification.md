# ğŸŒ± Hibernate Specification

## ğŸ¯ KhÃ¡i niá»‡m

**Specification** lÃ  má»™t mÃ´ hÃ¬nh truy váº¥n nÃ¢ng cao trong Spring Data JPA,
Ä‘Æ°á»£c xÃ¢y dá»±ng theo **pattern Specification** trong Domain Driven Design (DDD).

> NÃ³ cho phÃ©p báº¡n **táº¡o ra truy váº¥n Ä‘á»™ng (dynamic query)**,
> káº¿t há»£p **nhiá»u Ä‘iá»u kiá»‡n (where)** theo runtime, má»™t cÃ¡ch **linh hoáº¡t & reusable**.

## ğŸ§  TÃ³m gá»n:

- Báº¡n **khÃ´ng cáº§n viáº¿t 10 hÃ m `findBy...`** ná»¯a
- Thay vÃ o Ä‘Ã³, báº¡n táº¡o **Specification riÃªng** cho tá»«ng Ä‘iá»u kiá»‡n
- Rá»“i **combine cÃ¡c Ä‘iá»u kiá»‡n láº¡i (AND, OR)** Ä‘á»ƒ táº¡o query hoÃ n chá»‰nh

---

## âœ… 2. Khi nÃ o nÃªn dÃ¹ng Specification?

| TÃ¬nh huá»‘ng                                            | DÃ¹ng Specification?              |
| ----------------------------------------------------- | -------------------------------- |
| Truy váº¥n Ä‘Æ¡n giáº£n: findByName                         | âŒ KhÃ´ng cáº§n                     |
| Truy váº¥n nhiá»u Ä‘iá»u kiá»‡n tÃ¹y chá»n                     | âœ… NÃªn dÃ¹ng                      |
| Form lá»c sáº£n pháº©m theo giÃ¡, tÃªn, loáº¡i, tráº¡ng thÃ¡i,... | âœ… Specification máº¡nh nháº¥t á»Ÿ Ä‘Ã¢y |
| Báº¡n muá»‘n build há»‡ thá»‘ng tÃ¬m kiáº¿m linh hoáº¡t            | âœ… âœ”ï¸ âœ”ï¸ âœ”ï¸                      |

---

## âœ… 3. YÃªu cáº§u Ä‘á»ƒ dÃ¹ng Specification

1. Entity class: `@Entity`
2. Repository extends `JpaSpecificationExecutor<T>`

```java
public interface ProductRepository extends JpaRepository<Product, Long>,
                                           JpaSpecificationExecutor<Product> {
}
```

---

## âœ… 4. CÃ¡ch viáº¿t Specification

```java
public class ProductSpecification {
    public static Specification<Product> hasName(String name) {
        return (root, query, cb) ->
            cb.like(cb.lower(root.get("name")), "%" + name.toLowerCase() + "%");
    }

    public static Specification<Product> hasPriceGreaterThan(Double price) {
        return (root, query, cb) ->
            cb.greaterThan(root.get("price"), price);
    }
}
```

ğŸ“Œ `root` â†’ Ã¡nh xáº¡ Ä‘áº¿n entity
ğŸ“Œ `cb` â†’ `CriteriaBuilder` Ä‘á»ƒ xÃ¢y WHERE clause
ğŸ“Œ `query` â†’ chÃ­nh lÃ  `CriteriaQuery` (cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ sort)

---

## âœ… 5. Combine Specification báº±ng `.and()` / `.or()`

```java
Specification<Product> spec = Specification.where(null);

if (name != null) {
    spec = spec.and(ProductSpecification.hasName(name));
}

if (minPrice != null) {
    spec = spec.and(ProductSpecification.hasPriceGreaterThan(minPrice));
}

List<Product> result = productRepository.findAll(spec);
```

âœ… **TÃ¹y thuá»™c input cá»§a user, báº¡n thÃªm hoáº·c bá» Ä‘iá»u kiá»‡n** â€” ráº¥t linh hoáº¡t!
