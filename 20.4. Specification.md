🔥 Câu hỏi cực hay và cực kỳ quan trọng khi bạn muốn **viết truy vấn nâng cao, linh hoạt, tái sử dụng** trong Spring Boot JPA!

> ❓ **Hibernate Specification là gì? Dùng khi nào? Và nó có gì mạnh?**

---

# 📘 Hibernate Specification – Lý thuyết toàn diện

---

## ✅ 1. Hibernate Specification là gì?

**Specification** là một mô hình truy vấn nâng cao trong Spring Data JPA,
được xây dựng theo **pattern Specification** trong Domain Driven Design (DDD).

> Nó cho phép bạn **tạo ra truy vấn động (dynamic query)**,
> kết hợp **nhiều điều kiện (where)** theo runtime, một cách **linh hoạt & reusable**.

---

## 🧠 Tóm gọn:

- Bạn **không cần viết 10 hàm `findBy...`** nữa
- Thay vào đó, bạn tạo **Specification riêng** cho từng điều kiện
- Rồi **combine các điều kiện lại (AND, OR)** để tạo query hoàn chỉnh

---

## ✅ 2. Khi nào nên dùng Specification?

| Tình huống                                            | Dùng Specification?              |
| ----------------------------------------------------- | -------------------------------- |
| Truy vấn đơn giản: findByName                         | ❌ Không cần                     |
| Truy vấn nhiều điều kiện tùy chọn                     | ✅ Nên dùng                      |
| Form lọc sản phẩm theo giá, tên, loại, trạng thái,... | ✅ Specification mạnh nhất ở đây |
| Bạn muốn build hệ thống tìm kiếm linh hoạt            | ✅ ✔️ ✔️ ✔️                      |

---

## ✅ 3. Yêu cầu để dùng Specification

1. Entity class: `@Entity`
2. Repository extends `JpaSpecificationExecutor<T>`

```java
public interface ProductRepository extends JpaRepository<Product, Long>,
                                           JpaSpecificationExecutor<Product> {
}
```

---

## ✅ 4. Cách viết Specification

```java
public class ProductSpecification {
    public static Specification<Product> hasName(String name) {
        return (root, query, cb) ->
            cb.like(cb.lower(root.get("name")), "%" + name.toLowerCase() + "%");
    }

    public static Specification<Product> hasPriceGreaterThan(Double price) {
        return (root, query, cb) ->
            cb.greaterThan(root.get("price"), price);
    }
}
```

📌 `root` → ánh xạ đến entity
📌 `cb` → `CriteriaBuilder` để xây WHERE clause
📌 `query` → chính là `CriteriaQuery` (có thể dùng để sort)

---

## ✅ 5. Combine Specification bằng `.and()` / `.or()`

```java
Specification<Product> spec = Specification.where(null);

if (name != null) {
    spec = spec.and(ProductSpecification.hasName(name));
}

if (minPrice != null) {
    spec = spec.and(ProductSpecification.hasPriceGreaterThan(minPrice));
}

List<Product> result = productRepository.findAll(spec);
```

✅ **Tùy thuộc input của user, bạn thêm hoặc bỏ điều kiện** — rất linh hoạt!

---

## ✅ 6. Ưu điểm Specification

| Ưu điểm                               | ✅  |
| ------------------------------------- | --- |
| Kết hợp truy vấn động cực tốt         | ✔️  |
| Dễ tách riêng điều kiện – tái sử dụng | ✔️  |
| Viết test dễ dàng                     | ✔️  |
| Không cần dùng `@Query` thủ công      | ✔️  |

---

## ✅ 7. Nhược điểm

| Hạn chế                        | Giải pháp          |
| ------------------------------ | ------------------ |
| Viết dài hơn so với `findBy`   | Nhưng reusable hơn |
| Phải hiểu rõ `CriteriaBuilder` | Học 1 lần xài mãi  |

---

## ✅ Tóm tắt:

| Bạn có...                                          | Nên dùng                               |
| -------------------------------------------------- | -------------------------------------- |
| 1 điều kiện cố định                                | `findBy...()`                          |
| 3-5 điều kiện tùy chọn                             | `@Query(...)`                          |
| 5+ điều kiện động, nhiều filter, tìm kiếm nâng cao | ✅ **Specification** là lựa chọn số 1! |

---

## 🎯 Kết luận

- ✅ Specification là **cách viết query nâng cao, mềm dẻo nhất trong Spring Data JPA**
- ✅ Cực kỳ phù hợp cho **filter sản phẩm, tìm kiếm động, backend cho hệ thống lọc nhiều tiêu chí**
- ✅ Học Specification = bạn đang **nâng cấp mình từ developer sang kiến trúc sư truy vấn**

---

👉 Bạn muốn mình build **demo filter sản phẩm theo tên, giá, trạng thái** dùng Specification?

Chỉ cần nói: **"Làm demo tìm kiếm bằng Specification"**, mình code từ repo → service → controller luôn cho bạn 🔧🤖
