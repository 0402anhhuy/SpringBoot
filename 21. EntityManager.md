# ğŸŒ± EntityManager

> `EntityManager` lÃ  **giao diá»‡n trung tÃ¢m (core API)** cá»§a JPA (Java Persistence API),
> dÃ¹ng Ä‘á»ƒ **quáº£n lÃ½ cÃ¡c entity** (Ä‘á»‘i tÆ°á»£ng Ã¡nh xáº¡ vá»›i báº£ng trong DB) vÃ  **thá»±c hiá»‡n cÃ¡c thao tÃ¡c vá»›i database**

## âœ… `EntityManager` giÃºp báº¡n:

| Chá»©c nÄƒng                      | MÃ´ táº£                                  |
| ------------------------------ | -------------------------------------- |
| ThÃªm entity vÃ o DB             | `persist()`                            |
| TÃ¬m kiáº¿m entity                | `find()`                               |
| Cáº­p nháº­t entity                | `merge()`                              |
| XoÃ¡ entity                     | `remove()`                             |
| Táº¡o truy váº¥n JPQL / Native SQL | `createQuery()`, `createNativeQuery()` |
| Quáº£n lÃ½ vÃ²ng Ä‘á»i entity        | Gáº¯n / detach / refresh, v.v.           |

---

## ğŸ§° Nhá»¯ng hÃ m quan trá»ng cá»§a `EntityManager`

| PhÆ°Æ¡ng thá»©c                | Chá»©c nÄƒng                     | DÃ¹ng khi nÃ o           |
| -------------------------- | ----------------------------- | ---------------------- |
| `persist(entity)`          | ThÃªm báº£n ghi má»›i              | Entity chÆ°a cÃ³ ID      |
| `merge(entity)`            | Cáº­p nháº­t báº£n ghi              | Entity Ä‘Ã£ cÃ³ ID        |
| `find(Class<T>, id)`       | TÃ¬m theo ID                   | Dá»… dÃ¹ng nháº¥t           |
| `remove(entity)`           | XoÃ¡ entity                    | Pháº£i load entity trÆ°á»›c |
| `createQuery(jpql, class)` | Táº¡o truy váº¥n JPQL             | Truy váº¥n custom        |
| `createNativeQuery(sql)`   | Táº¡o truy váº¥n SQL thuáº§n        | Khi cáº§n tá»‘i Æ°u         |
| `flush()`                  | Äá»“ng bá»™ ngay vá»›i DB           | Hiáº¿m khi cáº§n dÃ¹ng      |
| `detach(entity)`           | TÃ¡ch entity ra khá»i context   | Äá»ƒ trÃ¡nh update        |
| `clear()`                  | Clear háº¿t persistence context | Reset session          |

---

## ğŸ’¡ VÃ­ dá»¥ thá»±c táº¿:

```java
// ThÃªm má»›i
Product p = new Product("IPhone 15", 32000.0);
entityManager.persist(p);

// Cáº­p nháº­t
p.setPrice(30000.0);
entityManager.merge(p);

// TÃ¬m theo ID
Product found = entityManager.find(Product.class, 1L);

// XoÃ¡
entityManager.remove(found);
```

---

## ğŸ“¦ CÃ¡ch inject EntityManager trong Spring

```java
@PersistenceContext
private EntityManager entityManager;
```

> `@PersistenceContext` lÃ  annotation chuáº©n JPA giÃºp Spring inject EntityManager Ä‘Ãºng cÃ¡ch.

---

## ğŸ§  EntityManager vÃ  Hibernate

| KhÃ¡i niá»‡m     | Giáº£i thÃ­ch                                                           |
| ------------- | -------------------------------------------------------------------- |
| JPA           | Chá»‰ lÃ  **chuáº©n API**                                                 |
| Hibernate     | LÃ  **implementation phá»• biáº¿n nháº¥t cá»§a JPA**                          |
| EntityManager | API cá»§a JPA â€“ nhÆ°ng phÃ­a sau Spring Boot lÃ  **Hibernate xá»­ lÃ½ tháº­t** |

---

## âœ… Káº¿t luáº­n

| Ã                                      | CÃ³ Ä‘Ãºng? |
| -------------------------------------- | -------- |
| EntityManager lÃ  trung tÃ¢m thao tÃ¡c DB | âœ…       |
| DÃ¹ng Ä‘á»ƒ CRUD, query, transaction       | âœ…       |
| LÃ  API cá»§a JPA                         | âœ…       |
| Hibernate Ä‘á»©ng sau xá»­ lÃ½               | âœ…       |

---

ğŸ“£ Muá»‘n mÃ¬nh viáº¿t 1 class `ProductRepositoryImpl` dÃ¹ng toÃ n bá»™ cÃ¡c hÃ m cá»§a `EntityManager` Ä‘á»ƒ báº¡n thá»±c hÃ nh?

ğŸ‘‰ Chá»‰ cáº§n nÃ³i: **â€œDemo full CRUD báº±ng EntityManagerâ€**, mÃ¬nh code Ä‘á»§ cÃ¡c hÃ m `persist`, `merge`, `find`, `remove`, `query` cho báº¡n luyá»‡n nhÃ© ğŸ’ªğŸ”§ğŸ¤–
