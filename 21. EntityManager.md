# 🌱 EntityManager

> `EntityManager` là **giao diện trung tâm (core API)** của JPA (Java Persistence API),
> dùng để **quản lý các entity** (đối tượng ánh xạ với bảng trong DB) và **thực hiện các thao tác với database**

## ✅ `EntityManager` giúp bạn:

| Chức năng                      | Mô tả                                  |
| ------------------------------ | -------------------------------------- |
| Thêm entity vào DB             | `persist()`                            |
| Tìm kiếm entity                | `find()`                               |
| Cập nhật entity                | `merge()`                              |
| Xoá entity                     | `remove()`                             |
| Tạo truy vấn JPQL / Native SQL | `createQuery()`, `createNativeQuery()` |
| Quản lý vòng đời entity        | Gắn / detach / refresh, v.v.           |

---

## 🧰 Những hàm quan trọng của `EntityManager`

| Phương thức                | Chức năng                     | Dùng khi nào           |
| -------------------------- | ----------------------------- | ---------------------- |
| `persist(entity)`          | Thêm bản ghi mới              | Entity chưa có ID      |
| `merge(entity)`            | Cập nhật bản ghi              | Entity đã có ID        |
| `find(Class<T>, id)`       | Tìm theo ID                   | Dễ dùng nhất           |
| `remove(entity)`           | Xoá entity                    | Phải load entity trước |
| `createQuery(jpql, class)` | Tạo truy vấn JPQL             | Truy vấn custom        |
| `createNativeQuery(sql)`   | Tạo truy vấn SQL thuần        | Khi cần tối ưu         |
| `flush()`                  | Đồng bộ ngay với DB           | Hiếm khi cần dùng      |
| `detach(entity)`           | Tách entity ra khỏi context   | Để tránh update        |
| `clear()`                  | Clear hết persistence context | Reset session          |

---

## 💡 Ví dụ thực tế:

```java
// Thêm mới
Product p = new Product("IPhone 15", 32000.0);
entityManager.persist(p);

// Cập nhật
p.setPrice(30000.0);
entityManager.merge(p);

// Tìm theo ID
Product found = entityManager.find(Product.class, 1L);

// Xoá
entityManager.remove(found);
```

---

## 📦 Cách inject EntityManager trong Spring

```java
@PersistenceContext
private EntityManager entityManager;
```

> `@PersistenceContext` là annotation chuẩn JPA giúp Spring inject EntityManager đúng cách.

---

## 🧠 EntityManager và Hibernate

| Khái niệm     | Giải thích                                                           |
| ------------- | -------------------------------------------------------------------- |
| JPA           | Chỉ là **chuẩn API**                                                 |
| Hibernate     | Là **implementation phổ biến nhất của JPA**                          |
| EntityManager | API của JPA – nhưng phía sau Spring Boot là **Hibernate xử lý thật** |

---

## ✅ Kết luận

| Ý                                      | Có đúng? |
| -------------------------------------- | -------- |
| EntityManager là trung tâm thao tác DB | ✅       |
| Dùng để CRUD, query, transaction       | ✅       |
| Là API của JPA                         | ✅       |
| Hibernate đứng sau xử lý               | ✅       |

---

📣 Muốn mình viết 1 class `ProductRepositoryImpl` dùng toàn bộ các hàm của `EntityManager` để bạn thực hành?

👉 Chỉ cần nói: **“Demo full CRUD bằng EntityManager”**, mình code đủ các hàm `persist`, `merge`, `find`, `remove`, `query` cho bạn luyện nhé 💪🔧🤖
