# üå± EntityManager

> `EntityManager` l√† **giao di·ªán trung t√¢m (core API)** c·ªßa JPA (Java Persistence API),
> d√πng ƒë·ªÉ **qu·∫£n l√Ω c√°c entity** (ƒë·ªëi t∆∞·ª£ng √°nh x·∫° v·ªõi b·∫£ng trong DB) v√† **th·ª±c hi·ªán c√°c thao t√°c v·ªõi database**

## üß∞ Nh·ªØng h√†m quan tr·ªçng trong `EntityManager`

| Ph∆∞∆°ng th·ª©c                | Ch·ª©c nƒÉng                     | D√πng khi n√†o           |
| -------------------------- | ----------------------------- | ---------------------- |
| `persist(entity)`          | Th√™m b·∫£n ghi m·ªõi              | Entity ch∆∞a c√≥ ID      |
| `merge(entity)`            | C·∫≠p nh·∫≠t b·∫£n ghi              | Entity ƒë√£ c√≥ ID        |
| `find(Class<T>, id)`       | T√¨m theo ID                   | D·ªÖ d√πng nh·∫•t           |
| `remove(entity)`           | Xo√° entity                    | Ph·∫£i load entity tr∆∞·ªõc |
| `createQuery(jpql, class)` | T·∫°o truy v·∫•n JPQL             | Truy v·∫•n custom        |
| `createNativeQuery(sql)`   | T·∫°o truy v·∫•n SQL thu·∫ßn        | Khi c·∫ßn t·ªëi ∆∞u         |
| `flush()`                  | ƒê·ªìng b·ªô ngay v·ªõi DB           | Hi·∫øm khi c·∫ßn d√πng      |
| `detach(entity)`           | T√°ch entity ra kh·ªèi context   | ƒê·ªÉ tr√°nh update        |
| `clear()`                  | Clear h·∫øt persistence context | Reset session          |
| `getTransaction()`         | L·∫•y transaction hi·ªán t·∫°i      | Qu·∫£n l√Ω transaction    |
| `getCriteriaBuilder()`     | T·∫°o Criteria API              | Truy v·∫•n ph·ª©c t·∫°p      |

## üí° V√≠ d·ª•

```java
// Th√™m m·ªõi
Product p = new Product("IPhone 15", 32000.0);
entityManager.persist(p);

// C·∫≠p nh·∫≠t
p.setPrice(30000);
entityManager.merge(p);

// T√¨m theo ID
Product found = entityManager.find(Product.class, 1L);

// Xo√°
entityManager.remove(found);
```

## üì¶ Inject EntityManager trong Spring

```java
@PersistenceContext
private EntityManager entityManager;
```

> `@PersistenceContext` l√† annotation chu·∫©n JPA gi√∫p Spring inject EntityManager ƒë√∫ng c√°ch
