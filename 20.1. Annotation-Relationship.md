# ğŸŒ± Annotation Relationships

## ğŸ§† Annotations

| Annotation    | Má»‘i quan há»‡                         | HÆ°á»›ng      |
| ------------- | ----------------------------------- | ---------- |
| `@OneToOne`   | Má»™t â†” Má»™t                           | Cáº£ 2 chiá»u |
| `@OneToMany`  | Má»™t â†’ Nhiá»u                         | Má»™t chiá»u  |
| `@ManyToOne`  | Nhiá»u â†’ Má»™t                         | Má»™t chiá»u  |
| `@ManyToMany` | Nhiá»u â†” Nhiá»u                       | Cáº£ 2 chiá»u |
| `@JoinColumn` | Äá»‹nh nghÄ©a khÃ³a ngoáº¡i               |            |
| `@JoinTable`  | Báº£ng trung gian trong `@ManyToMany` |            |
| `@MappedBy`   | Äá»‹nh nghÄ©a quan há»‡ chiá»u ngÆ°á»£c      |            |

## ğŸŒ½ `@OneToOne` â€“ Quan há»‡ Má»™t â€“ Má»™t

### ğŸˆ CÃ¡c thuá»™c tÃ­nh

| Thuá»™c tÃ­nh      | Ã nghÄ©a                      |
| --------------- | ---------------------------- |
| `mappedBy`      | BÃªn bá»‹ phá»¥ thuá»™c             |
| `fetch`         | `LAZY` hoáº·c `EAGER`          |
| `cascade`       | HÃ nh vi insert/delete        |
| `optional`      | CÃ³ cho phÃ©p null             |
| `orphanRemoval` | XoÃ¡ luÃ´n khi bá»‹ xoÃ¡ liÃªn káº¿t |

### ğŸŒ³ VÃ­ dá»¥

- Táº¡o quan há»‡ má»™t - má»™t giá»¯a 2 báº£ng **User** vÃ  **UserProfile**

**`User.java`**

```java
@Entity
public class User {
    @Id
    private Long id;

    @OneToOne
    @JoinColumn(name = "profile_id")
    private UserProfile profile;
}
```

**`UserProfile.java`**

```java
@Entity
public class UserProfile {
    @Id
    private Long id;

    private String bio;
}
```

> Má»™t `User` chá»‰ cÃ³ má»™t `UserProfile`

## ğŸŒ´ `@OneToMany` â€“ Má»™t â†’ Nhiá»u

### ğŸ”· CÃ¡c thuá»™c tÃ­nh

| Thuá»™c tÃ­nh      | Ã nghÄ©a                                 |
| --------------- | --------------------------------------- |
| `mappedBy`      | TÃªn field á»Ÿ entity bÃªn kia giá»¯ FK       |
| `fetch`         | `LAZY` máº·c Ä‘á»‹nh (âš  nÃªn giá»¯ nguyÃªn)      |
| `cascade`       | Ghi Ä‘Ã¨, xoÃ¡, thÃªm                       |
| `orphanRemoval` | Náº¿u xoÃ¡ khá»i list thÃ¬ cÅ©ng xoÃ¡ trong DB |

- KhÃ´ng Ä‘Æ°á»£c dÃ¹ng `@JoinColumn` á»Ÿ phÃ­a nÃ y (dÃ¹ng `mappedBy`)

### ğŸ¥½ VÃ­ dá»¥

- Táº¡o quan há»‡ má»™t - nhiá»u giá»¯a 2 báº£ng **Category** vÃ  **Product**

**`Category.java`**

```java
@Entity
public class Category {
    @Id
    private Long id;

    @OneToMany(mappedBy = "category", cascade = CascadeType.ALL)
    private List<Product> products;
}
```

**`Product.java`**

```java
@Entity
public class Product {
    @Id
    private Long id;

    @ManyToOne
    @JoinColumn(name = "category_id")
    private Category category;
}
```

> Má»™t `Category` chá»©a nhiá»u `Product`

## ğŸŒ» `@ManyToOne` â€“ Nhiá»u â†’ Má»™t

### ğŸ”· CÃ¡c thuá»™c tÃ­nh

| Thuá»™c tÃ­nh    | Ã nghÄ©a                                     |
| ------------- | ------------------------------------------- |
| `fetch`       | `EAGER` máº·c Ä‘á»‹nh                            |
| `optional`    | CÃ³ báº¯t buá»™c pháº£i cÃ³ FK khÃ´ng?               |
| `cascade`     | Ãt khi dÃ¹ng á»Ÿ Ä‘Ã¢y, thÆ°á»ng khÃ´ng cascade lÃªn |
| `@JoinColumn` | Chá»‰ Ä‘á»‹nh tÃªn cá»™t FK                         |

- ÄÃ¢y lÃ  **bÃªn giá»¯ FK tháº­t sá»±**

### ğŸŒ¼ VÃ­ dá»¥

- Táº¡o quan há»‡ nhiá»u - má»™t giá»¯a 2 báº£ng **Product** vÃ  **Category**

**`Product.java`**

```java
@Entity
public class Product {
    @Id
    private Long id;

    @ManyToOne
    @JoinColumn(name = "category_id")
    private Category category;
}
```

## ğŸƒ `@ManyToMany` â€“ Nhiá»u â†” Nhiá»u

### ğŸ”· CÃ¡c thuá»™c tÃ­nh

| Thuá»™c tÃ­nh   | Ã nghÄ©a                                  |
| ------------ | ---------------------------------------- |
| `mappedBy`   | BÃªn bá»‹ phá»¥ thuá»™c                         |
| `cascade`    | ThÆ°á»ng dÃ¹ng `CascadeType.PERSIST, MERGE` |
| `@JoinTable` | Äá»‹nh nghÄ©a báº£ng trung gian               |
| `fetch`      | ThÆ°á»ng Ä‘á»ƒ `LAZY`                         |

### ğŸŒ³ VÃ­ dá»¥

- Táº¡o quan há»‡ nhiá»u - nhiá»u giá»¯a 2 báº£ng **Student** vÃ  **Course**

- Sá»­ dá»¥ng báº£ng trung gian `student_course` Ä‘á»ƒ lÆ°u trá»¯ má»‘i quan há»‡ (Hibernate sáº½ tá»± táº¡o báº£ng nÃ y)

**`Student.java`**

```java
@Entity
public class Student {
    @Id
    private Long id;

    @ManyToMany
    @JoinTable(
        name = "student_course",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private List<Course> courses;
}
```

**`Course.java`**

```java
@Entity
public class Course {
    @Id
    private Long id;

    @ManyToMany(mappedBy = "courses")
    private List<Student> students;
}
```

> Báº£ng trung gian `student_course` sáº½ Ä‘Æ°á»£c Hibernate táº¡o tá»± Ä‘á»™ng

## ğŸ›´ `CascadeType` â€“ Xá»­ lÃ½ quan há»‡ khi thÃªm/xÃ³a

| Cascade             | Ã nghÄ©a                     |
| ------------------- | --------------------------- |
| `ALL`               | ThÃªm/sá»­a/xÃ³a theo quan há»‡   |
| `PERSIST`           | Tá»± thÃªm Ä‘á»‘i tÆ°á»£ng liÃªn quan |
| `MERGE`             | Tá»± cáº­p nháº­t                 |
| `REMOVE`            | Tá»± xÃ³a                      |
| `DETACH`, `REFRESH` | Ãt dÃ¹ng                     |

## â›µ `FetchType` â€“ Lazy vs Eager

| FetchType                           | Ã nghÄ©a                                      |
| ----------------------------------- | -------------------------------------------- |
| `LAZY` (máº·c Ä‘á»‹nh vá»›i `@OneToMany`)  | KhÃ´ng load dá»¯ liá»‡u liÃªn quan cho Ä‘áº¿n khi gá»i |
| `EAGER` (máº·c Ä‘á»‹nh vá»›i `@ManyToOne`) | Load táº¥t cáº£ dá»¯ liá»‡u liÃªn quan ngay láº­p tá»©c   |

```java
@OneToMany(fetch = FetchType.LAZY)
private List<Product> products;
```

## ğŸ” VÃ­ dá»¥

### Category â€“ Product (1\:N)

- `Category` â†’ `@OneToMany(mappedBy = "category")`
- `Product` â†’ `@ManyToOne + @JoinColumn`

### User â€“ Role (N\:N)

- `User` â†’ `@ManyToMany + @JoinTable(...)`
- `Role` â†’ `@ManyToMany(mappedBy = "roles")`
