# üå± Component Scan

## **üìå 1. ƒê·ªãnh nghƒ©a**

- Cho ph√©p Spring Boot t·ª± ƒë·ªông t√¨m ki·∫øm v√† qu·∫£n l√Ω c√°c `Bean` trong ·ª©ng d·ª•ng c·ªßa ch√∫ng ta.

- M·∫∑c ƒë·ªãnh, Spring Boot s·∫Ω qu√©t to√†n b·ªô c√°c package v√† c√°c package con c·ªßa package ch·ª©a h√†m main.

- V√≠ d·ª•:

  - N·∫øu **`@StoreApplication`** n·∫±m trong package `com.example.store`, th√¨ Spring s·∫Ω qu√©t:
    - `com.example.store`
    - `com.example.store.model`
    - `com.example.store.service`
    - `com.example.store.config`

- ƒêi·ªÅu g√¨ s·∫Ω x·∫£y ra khi m·ªôt class n·∫±m ngo√†i ph·∫°m vi qu√©t

  - N√≥ s·∫Ω kh√¥ng ƒë∆∞·ª£c qu√©t v√† Spring s·∫Ω kh√¥ng bi·∫øt ƒë·∫øn class ƒë√≥
  - V√≠ d·ª•:

    ````java
    package com.springmall;

        @Component
        public class Car{
            // Kh√¥ng ƒë∆∞·ª£c Spring qu·∫£n l√Ω
        }
        ```

    ‚û°Ô∏è Khi g·ªçi **`context.getBean(Car.class)`**, Spring s·∫Ω b√°o l·ªói _`NoSuchBeanDefinitionException`_.
    ````

## **üîπ 2. Thay ƒë·ªïi ph·∫°m vi Component Scan**

- Trong tr∆∞·ªùng h·ª£p mu·ªën t√πy ch·ªânh c·∫•u h√¨nh cho **`Component Scan`** ƒë·ªÉ ch·ªâ t√¨m ki·ªÉm c√°c **`Bean`** trong m·ªôt package nh·∫•t ƒë·ªãnh, c√≥ 3 c√°ch:

  ### 2.1. S·ª≠ d·ª•ng **`@Component Scan`**

  - N·∫øu `Car` n·∫±m ngo√†i package m·∫∑c ƒë·ªãnh, ch√∫ng ta c·∫ßn ch·ªâ ƒë·ªãnh Spring qu√©t n√≥ b·∫±ng **`@Component Scan`**

  ```java
  @SpringBootApplication
  @ComponentScan("com.springmall")

  public class StoreApplication{
      public static void main(String[] args){
          SpringApplication.run(StoreApplication.class, args);
      }
  }
  ```

  ### 2.2. S·ª≠ d·ª•ng **`@Component Scan`** v·ªõi `basePackages`

  ```java
  @Configuration
  @ComponentScan(basePackages = {"com.springmall.store", "com.springmall"})

  public class AppConfig{
  }
  ```

  üìå C√°ch n√†y h·ªØu √≠ch khi kh√¥ng mu·ªën s·ª≠a **`StoreApplication.java`**.

  ### 2.3. S·ª≠ d·ª•ng `scanBasePackages` trong `@SpringBootApplication`

  ```java
  @SpringBootApplication(scanBasePackages = "com.springmall")

  public class StoreApplication{
      public static void main(String[] args){
          SpringApplication.run(StoreApplication.class, args);
      }
  }
  ```

  ### 2.4. ƒê·ªãnh nghƒ©a **`@Bean`** trong **`AppConfig.java`**

  - Th·ª±c hi·ªán nh∆∞ ph·∫ßn **`Bean.md`**

  ### 2.5. Multiple package scan

  - C√≥ th·ªÉ c·∫•u h√¨nh cho **Spring Boot** t√¨m ki·∫øm c√°c `Bean` ·ªü nhi·ªÅu package kh√°c nhau.

  ```java
  @ComponentScan({"com.springmall.store","com.springmall"})
  ```

  ```java
  @SpringBootApplication(scanBasePackages = {"com.springmall", "com.springmall.store"})
  ```

## **üåø 3. Lazy-initialize Beans**

- Eager (h√°o h·ª©c): `Bean` ƒë∆∞·ª£c t·∫°o ngay khi ch·∫°y ch∆∞∆°ng tr√¨nh - **`@Scope("singleton")`**

- Lazy (l∆∞·ªùi): `Bean` ƒë∆∞·ª£c t·∫°o ra khi ch√∫ng ta g·ªçi ƒë·∫øn n√≥ - **`@Scope("prototype")`**

- C√°ch d√πng **`@Lazy`** tr√™n m·ªôt **`@Bean`** trong **`AppConfig.java`**:

  ```java
  @Configuration
  public class AppConfig{

      @Bean
      @Lazy
      public Engine engine(){
          System.out.println("Engine Bean ƒë∆∞·ª£c t·∫°o!");
          return new Engine("V8");
      }
  }
  ```

- K·∫øt qu·∫£:

  - N·∫øu kh√¥ng d√πng **`@Lazy`**, Engine s·∫Ω ƒë∆∞·ª£c t·∫°o ngay khi ·ª©ng d·ª•ng ch·∫°y.

  - N·∫øu d√πng **`@Lazy`**, Engine ch·ªâ ƒë∆∞·ª£c kh·ªüi t·∫°o khi m·ªôt bean kh√°c c·∫ßn n√≥.

- C√°ch d√πng **`@Lazy`** tr√™n m·ªôt **`@Component`**:
  ```java
  @Component
  @Lazy
  public class Car{
      public Car(){
          System.out.println("Car Bean ƒë∆∞·ª£c t·∫°o!");
      }
  }
  ```
- L∆∞u √Ω:
  - Khi l·∫•y `Car` l·∫ßn ƒë·∫ßu b·∫±ng **`context.getBean(Car.class)`**, Spring m·ªõi t·∫°o instance c·ªßa n√≥.

## **üòä 4. C√°ch b·∫≠t Lazy Initialization cho to√†n b·ªô ·ª©ng d·ª•ng**

- D√πng **`@ComponentScan(lazyInit = true)`**
- V√≠ d·ª•:

  ```java
  @SpringBootApplication
  @EnableAutoConfiguration
  @ComponentScan(lazyInit = true) // K√≠ch ho·∫°t lazy init to√†n c·ª•c

  public class StoreApplication{
      public static void main(String[] args){
          SpringApplication.run(StoreApplication.class, args);
      }
  }
  ```

- K·∫øt qu·∫£:
  - M·ªçi bean s·∫Ω ch·ªâ ƒë∆∞·ª£c kh·ªüi t·∫°o khi c·∫ßn thi·∫øt, gi√∫p gi·∫£m th·ªùi gian kh·ªüi ƒë·ªông ·ª©ng d·ª•ng.
- Khi n√†o n√™n d√πng **`@Lazy`**:

  - Khi bean kh√¥ng c·∫ßn thi·∫øt ngay khi kh·ªüi ƒë·ªông (v√≠ d·ª•: m·ªôt bean ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng trong m·ªôt API nh·∫•t ƒë·ªãnh).

  - Khi ·ª©ng d·ª•ng c√≥ nhi·ªÅu bean nh∆∞ng ch·ªâ m·ªôt s·ªë √≠t ƒë∆∞·ª£c s·ª≠ d·ª•ng th∆∞·ªùng xuy√™n (gi·∫£m t√†i nguy√™n s·ª≠ d·ª•ng ban ƒë·∫ßu).

  - Khi mu·ªën tƒÉng t·ªëc kh·ªüi ƒë·ªông ·ª©ng d·ª•ng, ƒë·∫∑c bi·ªát v·ªõi ·ª©ng d·ª•ng l·ªõn ho·∫∑c microservices.

  - Kh√¥ng n√™n d√πng @Lazy n·∫øu bean th·ª±c s·ª± c·∫ßn thi·∫øt ngay t·ª´ ƒë·∫ßu, v√¨ c√≥ th·ªÉ g√¢y l·ªói n·∫øu kh√¥ng ƒë∆∞·ª£c kh·ªüi t·∫°o k·ªãp.
