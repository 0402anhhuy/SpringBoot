ğŸ’¥ Ráº¥t cháº¥t lÆ°á»£ng! Báº¡n Ä‘Ã£ há»c Ä‘áº¿n **Hibernate Criteria API** â€” Ä‘Ã¢y lÃ  má»™t pháº§n quan trá»ng náº¿u báº¡n muá»‘n viáº¿t **truy váº¥n Ä‘á»™ng, linh hoáº¡t mÃ  khÃ´ng dÃ¹ng JPQL hay SQL thá»§ cÃ´ng**.

---

# ğŸ“˜ Hibernate Criteria API â€“ LÃ½ thuyáº¿t Ä‘áº§y Ä‘á»§

---

## âœ… 1. Hibernate Criteria lÃ  gÃ¬?

> **Criteria API** lÃ  má»™t cÃ¡ch **viáº¿t truy váº¥n hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (type-safe)** thay vÃ¬ dÃ¹ng chuá»—i SQL hoáº·c JPQL.

âœ” GiÃºp báº¡n:

- Táº¡o truy váº¥n **dáº¡ng Ä‘á»™ng** theo Ä‘iá»u kiá»‡n runtime
- Dá»… debug vÃ  khÃ´ng cáº§n viáº¿t chuá»—i SQL
- An toÃ n khi refactor (vÃ¬ dÃ¹ng tÃªn biáº¿n trong code)

> ğŸ“Œ Criteria lÃ  **API chuáº©n cá»§a JPA** tá»« phiÃªn báº£n 2.0
> (Spring Boot há»— trá»£ luÃ´n vÃ¬ Spring Data JPA dá»±a trÃªn JPA + Hibernate)

---

## âœ… 2. Æ¯u Ä‘iá»ƒm cá»§a Criteria

| Æ¯u Ä‘iá»ƒm                          | Giáº£i thÃ­ch                                        |
| -------------------------------- | ------------------------------------------------- |
| Type-safe                        | DÃ¹ng trá»±c tiáº¿p field cá»§a class, trÃ¡nh sai tÃªn cá»™t |
| Truy váº¥n Ä‘á»™ng                    | ThÃªm/bá» Ä‘iá»u kiá»‡n theo runtime                    |
| KhÃ´ng cáº§n viáº¿t JPQL thá»§ cÃ´ng     | Dá»… tÃ¡i sá»­ dá»¥ng                                    |
| PhÃ¹ há»£p khi form cÃ³ nhiá»u filter | âœ”ï¸ âœ”ï¸ âœ”ï¸                                          |

---

## âœ… 3. Cáº¥u trÃºc cÆ¡ báº£n cá»§a Criteria

```java
CriteriaBuilder cb = entityManager.getCriteriaBuilder(); // giá»‘ng SQL builder
CriteriaQuery<Product> cq = cb.createQuery(Product.class); // query cho entity Product
Root<Product> root = cq.from(Product.class); // gá»‘c: Ã¡nh xáº¡ Ä‘áº¿n báº£ng Product

cq.select(root)
  .where(cb.greaterThan(root.get("price"), 100.0)); // Ä‘iá»u kiá»‡n: price > 100

List<Product> result = entityManager.createQuery(cq).getResultList();
```

ğŸ“Œ Báº¡n viáº¿t truy váº¥n hoÃ n toÃ n báº±ng code Java â€” khÃ´ng cÃ³ chuá»—i SQL!

---

## âœ… 4. ThÃ nh pháº§n quan trá»ng

| ThÃ nh pháº§n         | Vai trÃ²                          |
| ------------------ | -------------------------------- |
| `CriteriaBuilder`  | "CÃ´ng cá»¥ xÃ¢y dá»±ng" cÃ¡c Ä‘iá»u kiá»‡n |
| `CriteriaQuery<T>` | LÃ  object Ä‘áº¡i diá»‡n cho cÃ¢u query |
| `Root<T>`          | Äáº¡i diá»‡n cho báº£ng Ä‘ang truy váº¥n  |
| `Predicate`        | Äáº¡i diá»‡n cho Ä‘iá»u kiá»‡n WHERE     |
| `TypedQuery<T>`    | Äá»ƒ thá»±c thi cÃ¢u truy váº¥n         |

---

## âœ… 5. VÃ­ dá»¥ cÃ¡c Ä‘iá»u kiá»‡n trong Criteria

### ğŸ“Œ WHERE name = ?

```java
cb.equal(root.get("name"), "Iphone")
```

### ğŸ“Œ price > 100

```java
cb.greaterThan(root.get("price"), 100.0)
```

### ğŸ“Œ name like '%phone%'

```java
cb.like(cb.lower(root.get("name")), "%phone%")
```

### ğŸ“Œ price BETWEEN 100 AND 500

```java
cb.between(root.get("price"), 100.0, 500.0)
```

### ğŸ“Œ price > 100 AND name like '%phone%'

```java
cb.and(
    cb.greaterThan(root.get("price"), 100.0),
    cb.like(root.get("name"), "%phone%")
)
```

---

## âœ… 6. Truy váº¥n Ä‘á»™ng nhiá»u Ä‘iá»u kiá»‡n (runtime)

```java
List<Predicate> predicates = new ArrayList<>();

if (name != null) {
    predicates.add(cb.like(root.get("name"), "%" + name + "%"));
}
if (minPrice != null) {
    predicates.add(cb.greaterThanOrEqualTo(root.get("price"), minPrice));
}

cq.where(cb.and(predicates.toArray(new Predicate[0])));
```

âœ… Cá»±c ká»³ há»¯u Ã­ch khi lÃ m form lá»c sáº£n pháº©m, tÃ¬m kiáº¿m theo nhiá»u tiÃªu chÃ­ tÃ¹y ngÆ°á»i dÃ¹ng chá»n.

---

## âœ… 7. Káº¿t há»£p vá»›i `EntityManager`

```java
TypedQuery<Product> query = entityManager.createQuery(cq);
List<Product> result = query.getResultList();
```

---

## âœ… 8. So sÃ¡nh vá»›i Specification

| Äáº·c Ä‘iá»ƒm              | Criteria API | Specification         |
| --------------------- | ------------ | --------------------- |
| API chuáº©n JPA         | âœ…           | âœ…                    |
| Cáº§n `EntityManager`   | âœ…           | âŒ (Spring tá»± inject) |
| CÃ³ thá»ƒ dÃ¹ng á»Ÿ má»i nÆ¡i | âœ…           | Chá»‰ trong Repository  |
| Code dÃ i hÆ¡n          | âœ…           | âŒ                    |
| Dá»… test, tÃ¡i sá»­ dá»¥ng  | âŒ           | âœ…                    |

ğŸ§  Khi dÃ¹ng Spring Data JPA, nÃªn Æ°u tiÃªn dÃ¹ng **Specification** (nÃ³ dÃ¹ng Criteria bÃªn dÆ°á»›i).

---

## âœ… Káº¿t luáº­n

| TÃ³m gá»n                                                                | Ã nghÄ©a |
| ---------------------------------------------------------------------- | ------- |
| Criteria API lÃ  **cÃ¡ch viáº¿t truy váº¥n Ä‘á»™ng, type-safe** trong Hibernate |         |
| TrÃ¡nh lá»—i cÃº phÃ¡p, viáº¿t Ä‘Æ°á»£c má»i logic phá»©c táº¡p                        |         |
| DÃ¹ng khi cÃ³ nhiá»u filter tÃ¹y ngÆ°á»i dÃ¹ng                                |         |
| Káº¿t há»£p tá»‘t vá»›i `EntityManager` hoáº·c `Specification`                   |         |

---

ğŸ“Œ Báº¡n muá»‘n mÃ¬nh lÃ m demo:

- Viáº¿t filter sáº£n pháº©m theo tÃªn + giÃ¡ + loáº¡i
- DÃ¹ng Criteria API full code cÃ³ controller + form HTML?

ğŸ‘‰ Chá»‰ cáº§n nÃ³i â€œDemo lá»c sáº£n pháº©m báº±ng Criteriaâ€, mÃ¬nh lÃ m tá»« A â†’ Z cho báº¡n ngay ğŸ”§ğŸ¤–
