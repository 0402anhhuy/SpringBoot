💥 Rất chất lượng! Bạn đã học đến **Hibernate Criteria API** — đây là một phần quan trọng nếu bạn muốn viết **truy vấn động, linh hoạt mà không dùng JPQL hay SQL thủ công**.

---

# 📘 Hibernate Criteria API – Lý thuyết đầy đủ

---

## ✅ 1. Hibernate Criteria là gì?

> **Criteria API** là một cách **viết truy vấn hướng đối tượng (type-safe)** thay vì dùng chuỗi SQL hoặc JPQL.

✔ Giúp bạn:

- Tạo truy vấn **dạng động** theo điều kiện runtime
- Dễ debug và không cần viết chuỗi SQL
- An toàn khi refactor (vì dùng tên biến trong code)

> 📌 Criteria là **API chuẩn của JPA** từ phiên bản 2.0
> (Spring Boot hỗ trợ luôn vì Spring Data JPA dựa trên JPA + Hibernate)

---

## ✅ 2. Ưu điểm của Criteria

| Ưu điểm                          | Giải thích                                        |
| -------------------------------- | ------------------------------------------------- |
| Type-safe                        | Dùng trực tiếp field của class, tránh sai tên cột |
| Truy vấn động                    | Thêm/bỏ điều kiện theo runtime                    |
| Không cần viết JPQL thủ công     | Dễ tái sử dụng                                    |
| Phù hợp khi form có nhiều filter | ✔️ ✔️ ✔️                                          |

---

## ✅ 3. Cấu trúc cơ bản của Criteria

```java
CriteriaBuilder cb = entityManager.getCriteriaBuilder(); // giống SQL builder
CriteriaQuery<Product> cq = cb.createQuery(Product.class); // query cho entity Product
Root<Product> root = cq.from(Product.class); // gốc: ánh xạ đến bảng Product

cq.select(root)
  .where(cb.greaterThan(root.get("price"), 100.0)); // điều kiện: price > 100

List<Product> result = entityManager.createQuery(cq).getResultList();
```

📌 Bạn viết truy vấn hoàn toàn bằng code Java — không có chuỗi SQL!

---

## ✅ 4. Thành phần quan trọng

| Thành phần         | Vai trò                          |
| ------------------ | -------------------------------- |
| `CriteriaBuilder`  | "Công cụ xây dựng" các điều kiện |
| `CriteriaQuery<T>` | Là object đại diện cho câu query |
| `Root<T>`          | Đại diện cho bảng đang truy vấn  |
| `Predicate`        | Đại diện cho điều kiện WHERE     |
| `TypedQuery<T>`    | Để thực thi câu truy vấn         |

---

## ✅ 5. Ví dụ các điều kiện trong Criteria

### 📌 WHERE name = ?

```java
cb.equal(root.get("name"), "Iphone")
```

### 📌 price > 100

```java
cb.greaterThan(root.get("price"), 100.0)
```

### 📌 name like '%phone%'

```java
cb.like(cb.lower(root.get("name")), "%phone%")
```

### 📌 price BETWEEN 100 AND 500

```java
cb.between(root.get("price"), 100.0, 500.0)
```

### 📌 price > 100 AND name like '%phone%'

```java
cb.and(
    cb.greaterThan(root.get("price"), 100.0),
    cb.like(root.get("name"), "%phone%")
)
```

---

## ✅ 6. Truy vấn động nhiều điều kiện (runtime)

```java
List<Predicate> predicates = new ArrayList<>();

if (name != null) {
    predicates.add(cb.like(root.get("name"), "%" + name + "%"));
}
if (minPrice != null) {
    predicates.add(cb.greaterThanOrEqualTo(root.get("price"), minPrice));
}

cq.where(cb.and(predicates.toArray(new Predicate[0])));
```

✅ Cực kỳ hữu ích khi làm form lọc sản phẩm, tìm kiếm theo nhiều tiêu chí tùy người dùng chọn.

---

## ✅ 7. Kết hợp với `EntityManager`

```java
TypedQuery<Product> query = entityManager.createQuery(cq);
List<Product> result = query.getResultList();
```

---

## ✅ 8. So sánh với Specification

| Đặc điểm              | Criteria API | Specification         |
| --------------------- | ------------ | --------------------- |
| API chuẩn JPA         | ✅           | ✅                    |
| Cần `EntityManager`   | ✅           | ❌ (Spring tự inject) |
| Có thể dùng ở mọi nơi | ✅           | Chỉ trong Repository  |
| Code dài hơn          | ✅           | ❌                    |
| Dễ test, tái sử dụng  | ❌           | ✅                    |

🧠 Khi dùng Spring Data JPA, nên ưu tiên dùng **Specification** (nó dùng Criteria bên dưới).

---

## ✅ Kết luận

| Tóm gọn                                                                | Ý nghĩa |
| ---------------------------------------------------------------------- | ------- |
| Criteria API là **cách viết truy vấn động, type-safe** trong Hibernate |         |
| Tránh lỗi cú pháp, viết được mọi logic phức tạp                        |         |
| Dùng khi có nhiều filter tùy người dùng                                |         |
| Kết hợp tốt với `EntityManager` hoặc `Specification`                   |         |

---

📌 Bạn muốn mình làm demo:

- Viết filter sản phẩm theo tên + giá + loại
- Dùng Criteria API full code có controller + form HTML?

👉 Chỉ cần nói “Demo lọc sản phẩm bằng Criteria”, mình làm từ A → Z cho bạn ngay 🔧🤖
